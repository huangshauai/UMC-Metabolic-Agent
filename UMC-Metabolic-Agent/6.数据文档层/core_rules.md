# UMC-Metabolic-Agent 核心规则文档
# core_rules.md
## 1. 核心设计原则
### 1.1 通用原则
- 极简易用：核心功能开箱即用，无需复杂配置，新手可5分钟上手
- 领域兼容：所有模块/脚本需兼容多领域数据集，无领域锁定
- 可复现性：固定随机种子、明确依赖版本，相同输入必产生相同输出
- 容错优先：单个功能失败不影响整体运行，错误提示清晰可定位
- 轻量化：无冗余依赖/代码，核心模块体积≤100KB，运行内存≤2GB/任务

### 1.2 代码设计原则
- 模块化：单一功能对应单一模块，模块间通过清晰接口交互
- 语义化：变量/函数/类命名遵循“英文语义化”，禁止拼音/缩写/无意义命名
- 低耦合：模块间依赖最小化，核心模块（如universal_cmd.py）不依赖业务模块
- 高内聚：同一模块内的功能高度相关，无跨领域混合代码
- 可测试：核心功能需设计单元测试用例，测试覆盖率≥80%

### 1.3 数据集设计原则
- 字段统一：所有领域数据集必须包含5个通用字段（timestamp/sample_id/domain_adapt_score/core_factor/stability）
- 数值合理：领域特有字段数值符合物理/业务规律，无异常值/负数（合理场景除外）
- 格式规范：CSV编码为UTF-8，分隔符为逗号，无乱码/空行/重复行
- 规模适配：默认数据集规模为1000条样本，可配置但不建议＜500或＞10000条

## 2. 核心使用规则
### 2.1 环境使用规则
- Python版本：仅支持3.8+，禁止在3.7及以下版本运行（避免语法兼容问题）
- 依赖管理：必须使用requirements.txt明确依赖版本，禁止使用`pip install`无版本号安装
- 路径规则：所有文件路径优先使用相对路径，禁止硬编码绝对路径（如C:\UMC\data.csv）
- 权限规则：运行脚本需保证当前用户对输出目录有读写权限，禁止以root/Administrator强制运行

### 2.2 功能使用规则
#### 2.2.1 运行规则
- 输入验证：运行前必须验证数据集路径/格式/字段完整性，无验证不执行核心逻辑
- 进度反馈：运行/调优过程中必须实时输出进度（百分比/剩余时间），禁止静默运行
- 结果输出：输出文件必须包含核心指标、运行时间、配置参数，便于结果追溯
- 资源控制：批量运行时CPU利用率≤80%，并行线程数≤CPU核心数（避免资源耗尽）

#### 2.2.2 调优规则
- 参数范围：学习率（0.001-0.1）、迭代次数（10-500）、核心因子权重（0.1-1.0），禁止超出范围
- 收敛判断：满足“连续10次迭代得分变化≤0.001”或“达到迭代上限”时必须停止调优
- 结果保存：调优过程中实时保存最优参数，即使强制终止也需保留已生成的最优结果
- 评估标准：调优后核心指标提升率≥5%才判定为“调优有效”，否则输出优化建议

### 2.3 批量处理规则
- 任务隔离：每个批量任务对应独立目录，任务间无文件/内存共享
- 失败重试：单个任务失败可配置重试（默认重试2次），重试失败则跳过并记录原因
- 汇总规则：批量完成后必须生成汇总报告，包含成功率/最优任务/领域对比/失败原因
- 断点续跑：批量任务支持断点续跑，重启后从失败/未执行的任务开始，禁止重复执行已完成任务

## 3. 核心扩展规则
### 3.1 新增领域数据集规则
- 字段兼容：新增数据集必须保留5个通用字段，领域特有字段命名需符合领域语义（如天体物理用stellar_magnitude）
- 生成脚本：必须提供对应的generate_*.py脚本，包含固定随机种子、参数配置区、数据验证逻辑
- 文档配套：新增数据集需补充README.md中的数据集列表，明确核心优化指标和使用示例
- 质量校验：必须通过quality_control.txt中的数据集质量检查标准，否则禁止合并

### 3.2 新增功能模块规则
- 接口兼容：新增模块需兼容现有核心接口（如universal_cmd.py的run()函数参数格式）
- 日志规范：新增模块必须使用项目统一的日志配置，禁止自定义print/日志格式
- 测试覆盖：新增功能需补充单元测试用例，测试覆盖率≥80%
- 文档更新：新增功能需更新core_rules.md和README.md，明确功能说明和使用规则

### 3.3 新增运行脚本规则
- 参数规范：新增脚本必须支持--help参数，输出清晰的使用说明/参数列表/示例命令
- 容错逻辑：必须包含文件不存在/参数错误/数据异常的容错处理，禁止直接抛出未捕获异常
- 输出统一：输出目录/文件命名格式需与现有脚本一致（如batch_result_20260118.json）
- 依赖最小：新增脚本依赖需≤现有核心依赖，禁止引入无必要的重量级依赖（如TensorFlow/PyTorch）

## 4. 核心安全规则
### 4.1 数据安全规则
- 隐私保护：禁止在数据集/脚本中存储敏感信息（如密码/密钥/个人信息）
- 数据存储：运行生成的敏感结果（如调优参数）需加密存储（bcrypt/SHA256），禁止明文存储
- 传输安全：API接口传输数据需使用HTTPS，禁止HTTP传输（本地测试除外）
- 备份规则：核心数据集/调优结果需自动备份（默认备份至./backup目录），备份周期≤24小时

### 4.2 代码安全规则
- 权限控制：身份认证模块（ext_identity.py）必须实现RBAC权限控制，禁止越权访问
- 密码安全：用户密码必须使用bcrypt哈希存储，禁止明文/MD5/SHA1存储
- 令牌安全：JWT令牌必须设置过期时间（默认2小时），禁止永久有效令牌
- 输入过滤：API接口/脚本参数必须过滤特殊字符（如../<>&），防止路径遍历/注入攻击

### 4.3 部署安全规则
- 端口安全：API服务默认端口≥10000，禁止使用1-1024的系统端口
- 访问控制：生产环境部署时，API服务仅允许指定IP访问，禁止公网开放
- 日志审计：生产环境需开启操作审计日志，记录所有核心操作（运行/调优/登录）
- 漏洞修复：发现安全漏洞后需在24小时内修复，修复后需进行安全测试

## 5. 核心维护规则
### 5.1 版本管理规则
- 版本号规范：遵循语义化版本（MAJOR.MINOR.PATCH），如v2.1.0
  - MAJOR：核心架构变更（如模块重构）
  - MINOR：新增功能/数据集（如新增分子动力学数据集）
  - PATCH：bug修复/小优化（如调整调优收敛阈值）
- 版本发布：每次版本发布需更新README.md的更新日志，附带详细的变更说明
- 分支管理：主分支（main）仅保留稳定版本，开发分支（dev）用于功能开发，禁止直接向main提交代码

### 5.2 问题修复规则
- 问题记录：所有问题需记录现象/复现步骤/错误日志，禁止无记录修复
- 修复验证：修复后需进行回归测试，确保修复不引入新问题
- 文档同步：问题修复后需同步更新quality_control.txt的常见问题列表（如适用）
- 通知规则：核心功能（如调优）的重大修复需通知所有使用者，避免使用旧版本

### 5.3 文档维护规则
- 实时更新：代码/数据集/脚本变更后，需在24小时内更新对应文档
- 文档规范：所有文档使用Markdown格式，结构清晰，关键信息用粗体/列表突出
- 示例完整：文档中的示例命令/代码需可直接复制运行，禁止残缺示例
- 语言统一：所有文档使用中文（简体），专业术语标注英文（如学习率（learning_rate））

## 6. 违规处理机制
### 6.1 违规类型
- 轻度违规：代码格式不规范、文档缺失少量信息、数据集数值轻微异常
- 中度违规：功能容错逻辑缺失、参数范围未限制、核心字段缺失
- 重度违规：模块高耦合、数据明文存储、核心功能不可复现、安全漏洞

### 6.2 处理方式
- 轻度违规：限期（24小时）整改，整改完成后重新审核
- 中度违规：暂停使用相关功能，整改完成并通过测试后恢复
- 重度违规：禁用相关模块/脚本，移除违规数据集，直至完全符合核心规则

### 6.3 申诉机制
- 对违规判定有异议的，可提交申诉（包含异议理由、整改方案）
- 申诉审核由项目维护团队完成，审核结果在48小时内反馈
- 申诉通过后，撤销违规判定，恢复相关功能/模块使用权限

## 7. 附则
- 本规则适用于UMC-Metabolic-Agent项目的所有模块、数据集、脚本、文档；
- 本规则的最终解释权归UMC-Metabolic-Agent开发团队所有；
- 本规则将根据项目发展持续更新，更新后会在README.md中通知；
- 使用者/贡献者需遵守本规则，违规使用导致的后果由使用者自行承担。

### 总结
1. 本规则覆盖UMC-Metabolic-Agent的设计、使用、扩展、安全、维护全流程，是项目开发和使用的核心准则；
2. 所有规则均围绕“易用、兼容、可复现、安全”的核心目标制定，违规处理机制保证规则落地；
3. 规则支持扩展和更新，新增功能/数据集需严格遵循扩展规则，确保项目整体一致性。